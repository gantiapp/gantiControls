{"admdatasource":{"name":"__GANTI_PG","source":"database"},"admTag":null,"apiPagination":null,"qymparams":[],"qymschedules":[],"admcomment":null,"type":"TABLE","query":"with\r\n  logs as (\r\n    select\r\n      planned_at at TIME ZONE 'UTC' AT TIME ZONE 'Europe\/Paris' as planned_at_paris,\r\n      *\r\n    from\r\n      admscheduleexecutionlog\r\n    where\r\n      date_trunc(\r\n        'day',\r\n        planned_at at TIME ZONE 'UTC' AT TIME ZONE 'Europe\/Paris'\r\n      ) = DATE_TRUNC('day', timezone ('Europe\/Paris', CURRENT_DATE))\r\n  )\r\nselect\r\n  log.id as log_id,\r\n  sch.*,\r\n  start_time as launched_at,\r\n  CASE\r\n    WHEN log.id IS NULL and schedule_time < timezone ('Europe\/Paris', NOW()) THEN 'FAILED ?'\r\n    WHEN error_message IS not NULL THEN error_message\r\n    WHEN schedule_time >= timezone ('Europe\/Paris', NOW()) THEN 'NOT YET EXECUTED'\r\n    ELSE 'OK'\r\n  END AS status,\r\n  execution_time,\r\n  rows_nbr\r\nfrom\r\n  v_schedules_of_the_day sch\r\n  left join logs log\r\n    on log.schedule_id = sch.schedule_id\r\n    and (\r\n      (log.predecessor_schedule_id IS NULL\r\n        and date_trunc('minute', sch.schedule_time) = date_trunc('minute', log.planned_at_paris)\r\n      )\r\n      or\r\n      (log.predecessor_schedule_id IS NOT NULL\r\n        and date_trunc('minute', sch.schedule_time) = date_trunc( 'minute', ( DATE(log.planned_at_paris) + get_recursive_schedule_time (log.control_type, log.schedule_id) )::timestamp ) )\r\n    )\r\nwhere\r\n  (error_message <> '' or log.id is null)\r\n  AND (schedule_time < timezone ('Europe\/Paris', NOW()) or schedule_time is null)\r\n  and control_name <> 'GTI - failed schedules'\r\norder by\r\n  schedule_time,\r\n  control_type,\r\n  control_name;","route":null,"method":null,"threshold":0,"qymFields":[{"qymAlerts":[],"name":"log_id"},{"qymAlerts":[],"name":"control_id"},{"qymAlerts":[],"name":"control_type"},{"qymAlerts":[],"name":"control_name"},{"qymAlerts":[],"name":"schedule_id"},{"qymAlerts":[],"name":"type"},{"qymAlerts":[],"name":"schedule_time"},{"qymAlerts":[],"name":"interval_end"},{"qymAlerts":[],"name":"launched_at"},{"qymAlerts":[],"name":"executiontime"},{"qymAlerts":[],"name":"rowsnumber"}],"qymApiParams":[],"admMenuControl":{"admMenu":{"name":"Queries","parentAdmMenu":null}},"spreadsheetUrl":null,"sheetName":null,"sheetRange":null,"mongodbCollection":null,"mongodbFilter":null,"mongodbProjection":null,"mongodbOptions":null,"mongodbAggregation":null,"name":"GTI - failed schedules","description":null,"roles":["DEFAULT"],"exportVersion":"25.10.1","controlType":"query_manager"}
